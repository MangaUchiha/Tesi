\chap{Data set elaboration: VBA expressions}\label{chap:appendixvbaexpressions}
This appendix provides all the code used in this thesis to elaborate the data set. Visual Basic for Application (VBA) is the programming language chosen for this purpose, as the most effective and manageable way of elaborating data in excel sheets. Further information can be found throughout this thesis, especially in Section \ref{sec:datasetelaboration} at page \pageref{sec:datasetelaboration}.

In the following appendix, cells are indicated as combination of a letter (identifying the column) and a number (identifying the line), as they originally were in the database. Every line represents a single child's evaluation; every column represents one of the examined parameters. The full column-parameter correspondence can be found in following Table \ref{tab:columnparameter}.

% Column-parameter correspondence table
\begin{table}[ht!]
	\centering 
	\def\arraystretch{1.5}
	\begin{tabularx}{\textwidth}{|C|C|C|}
		\hline
		\textbf{Column} & \textbf{Parameter} & \textbf{Description} \\
		\hline \hline
		A & Name and surname & Although registering the name of the patient posed a risk in terms of possible privacy breach, it was added nonetheless to easily identify each patient as the data set got bigger.\\
		\hline
		B & Age (in years) & The age of the kid  \\
		\hline
		C & Age (in months) & ASD. For further information, see Section \ref{sec:ageinmonths} \\
		\hline
	\end{tabularx}
	\captionof{table}{Column-parameter correspondence}
	\label{tab:columnparameter}
\end{table}

\section{Age (in months)}\label{sec:ageinmonths}
This VBA expression checks the \textit{Age (in months)} column (C) and, if it's not empty, it divides it's value by 12, rounding it down, just as age works.\\
The \texttt{ROUNDOWN} function was implemented in order to avoid overestimating child's age.

% Excel equation of age (in months)
\begin{minipage}{\linewidth}
\begin{lstlisting}
=IF(
   C2 <> "";
   ROUNDDOWN(
      C2 / 12;
      0
   );
   ""
)
\end{lstlisting}
\end{minipage}

\section{Geographic area of origin}\label{sec:geographicarea}
To further understand how geographic origin influenced the results of our screening program, every nation was grouped up in 4 major continents or areas with the following excel expression.

% Excel equation of nationality
% No minipage so it can page break
\begin{lstlisting}
=IF(
   OR(
      E2 = "Russia";
      E2 = "Albania";
      E2 = "Bulgaria";
      E2 = "Hungary";
      E2 = "Ukraine";
      E2 = "Moldavia";
      E2 = "Romania"
   );
   "Eastern Europe";
   IF(
      OR(
         E2 = "Burkina Faso";
         E2 = "Ethiopia";
         E2 = "Ivory Coast";
         E2 = "Congo";
         E2 = "Guinea Bissau";
         E2 = "Africa";
         E2 = "Ghana";
         E2 = "Benin"
      );
      "Africa";
      IF(
         OR(
            E2 = "Colombia";
            E2 = "Brazil";
            E2 = "Guatemala";
            E2 = "Peru";
            E2 = "Costa Rica"
         );
         "South America";
         IF(
            OR(
               E2 = "Armenia";
               E2 = "India";
               E2 = "China";
               E2 = "Vietnam";
               E2 = "Sri Lanka";
               E2 = "Siberia";
               E2 = "Nepal";
               E2 = "Philippines"
            );
            "Asia";
            ""
         )
      )
   )
)
\end{lstlisting}

\section{Pathological values}\label{sec:pathologicalvalues}
The data set contained numerical values for many laboratory analyses. Cut-off values for these results were established via the most recent literature review, as explained in Section \ref{sub:cutoffvalues}. In the following sections, the code used to establish which ones where pathological and which were not, is displayed and shortly explained.

\subsection{Weight and height}\label{sub:patweightandheight}
These parameters, since they had already been converted to percentile values, were easily implemented with the following simple VBA expression:

% Excel equation of pathological weight and height
\begin{minipage}{\linewidth}
\begin{lstlisting}
=IF(
   H2 <> "";
   IF(
      H2 <= 10;
      1;
      0
   );
   ""
)
\end{lstlisting}\
\end{minipage}

\subsection{Haemoglobin}\label{sub:pathaemoglobin}
Hemoglobin required a more complicated and sophisticated expression, in order to be stratified, because hemoglobin pathological cut-offs depend on various factors, as described in Section \ref{sub:haemoglobin}. Moreover mild, moderate and severe anemias had to be separated in order to properly evaluate the child's health status; each one had an arbitrary value of 1 (\textit{mild}), 2 (\textit{moderate}) or 3 (\textit{severe}) associated to it.

% Excel equation of pathological hemoglobin
% No minipage so it can page break
\begin{lstlisting}
=IF(
   L2 <> "";
   IF(
      AND(
         C2 >= 6;
         C2 < 60
      );
      IF(
         L2 >= 11;
         0;
         IF(
            AND(
               L2 < 11;
               L2 >= 10
            );
            1;
            IF(
               AND(
                  L2 < 10;
                  L2 >= 7
               );
               2;
               3
            )
         )
      );
      IF(
         AND(
            C2 >= 60;
            C2 < 132
         );
         IF(
            L2 >= 11,5;
            0;
            IF(
               AND(
                  L2 < 11,5;
                  L2 >= 11
               );
               1;
               IF(
                  AND(
                     L2 < 11;
                     L2 >= 8
                  );
                  2;
                  3
               )
            )
         );
         IF(
            AND(
               C2 >= 132;
               C2 < 168
            );
            IF(
               L2 >= 12;
               0;
               IF(
                  AND(
                     L2 < 12;
                     L2 >= 11
                  );
                  1;
                  IF(
                     AND(
                        L2 < 11;
                        L2 >= 8
                     );
                     2;
                     3
                  )
               )
            )
         )
      )
   );
   ""
)
\end{lstlisting}

\subsection{MCV}\label{sub:patmcv}
As just described for haemoglobin, MCV required more complicated techniques in order to be stratified, because of its variability (through age, sex, ecc\dots), as described in Section \ref{sub:mcv}. Moreover, boolean results couldn't be accepted for this parameter, so arbitrary values were used to appropriately identify microcytic (\textit{1}) and macrocytic (\textit{2}) anemias.

% Excel equation of pathological mcv
% No minipage so it can page break
\begin{lstlisting}
=IF(
   N2 <> "";
   IF(
      B2 = "F";
      IF(
         AND(
            C2 >= 0;
            C2 < 60
         );
         IF(
            N2 > 85;
            2;
            IF(
               AND(
                  N2 <= 85;
                  N2 >= 69
               );
               0;
               1
            )
         );
         IF(
            AND(
               C2 >= 60;
               C2 < 120
            );
            IF(
               N2 > 89;
               2;
               IF(
                  AND(
                     N2 <= 89;
                     N2 >= 75
                  );
                  0;
                  1
               )
            );
            IF(
               AND(
                  C2 >= 120;
                  C2 < 168
               );
               IF(
                  N2 > 92;
                  2;
                  IF(
                     AND(
                        N2 <= 92;
                        N2 >= 78
                     );
                     0;
                     1
                  )
               )
            )
         )
      );
      IF(
         B2 = "M";
         IF(
            AND(
               C2 >= 0;
               C2 < 60
            );
            IF(
               N2 > 85;
               2;
               IF(
                  AND(
                     N2 <= 85;
                     N2 >= 71
                  );
                  0;
                  1
               )
            );
            IF(
               AND(
                  C2 >= 60;
                  C2 < 120
               );
               IF(
                  N2 > 88;
                  2;
                  IF(
                     AND(
                        N2 <= 88;
                        N2 >= 76
                     );
                     0;
                     1
                  )
               );
               IF(
                  AND(
                     C2 >= 120;
                     C2 < 168
                  );
                  IF(
                     N2 > 90;
                     2;
                     IF(
                        AND(
                           N2 <= 90;
                           N2 >= 76
                        );
                        0;
                        1
                     )
                  )
               )
            )
         );
         ""
      )
   );
   ""
)
\end{lstlisting}

\subsection{Circulating iron}\label{sub:patiron}
The following VBA expression was used to establish whether circulating iron levels were insufficient. 

% Excel equation of pathological iron
\begin{minipage}{\linewidth}
\begin{lstlisting}
=IF(
   P2 <> "";
   IF(
      AND(
         P2 >= 16;
         P2 <= 129
      );
      0;
      1
   );
   ""
)
\end{lstlisting}
\end{minipage}

\subsection{Ferritin}\label{sub:patferritin}
The following VBA expression was used to identify pathological ferritin values. These were, again, stratified for \textit{mild} (\textit{1}), \textit{moderate} (\textit{2}) and \textit{severe} (\textit{3}) deficiencies. 

% Excel equation of pathological ferritin
% No minipage so it can page break
\begin{lstlisting}
=IF(
   R2 <> "";
   IF(
      R2 >= 20;
      0;
      IF(
         AND(
            R2 < 20;
            R2 >= 15
         );
         1;
         IF(
            AND(
               R2 < 15;
               R2 >= 10
            );
            2;
            IF(
               R2 < 10;
               3
            )
         )
      )
   );
   ""
)
\end{lstlisting}

\subsection{Vitamin D}\label{sub:patvitaminD}
The following VBA expression was used to establish whether Vitamin D (serum \textit{25-hydroxycholecalciferol}) values were \textit{insufficient} (\textit{1}), \textit{deficient} (\textit{2}) or \textit{severely deficient} (\textit{3}). The predictive choice for this marker is explained at Section \ref{sub:vitaminD}.

% Excel equation of pathological vitamin D
% No minipage so it can page break
\begin{lstlisting}
=IF(
   AA2 <> "";
   IF(
      AA2 >= 50;
      0;
      IF(
         AND(
            AA2 < 50;
            AA2 >= 25
         );
         1;
         IF(
            AND(
               AA2 < 25;
               AA2 >= 10
            );
            2;
            IF(
               AA2 < 10;
               3
            )
         )
      )
   );
   ""
)
\end{lstlisting}